<h4 class="titulo">CUENTAS POR COBRAR</h4>

<div class="contenedor-principal">
  <!-- IZQUIERDA: Buscar unidad -->
  <div class="contenedor-unidades">
    <ng-container *ngIf="!cargandoUnidades; else cargandoSpinner">
    <h5>Seleccione la unidad</h5>
    <input
      type="text"
      [(ngModel)]="filtro"
      placeholder="Buscar unidad o nombre"
      class="buscador"
    />
    <button class="boton-volver" (click)="volver()">← Volver</button>
    <table class="tabla-unidades">
      <thead>
        <tr>
          <th>UNIDAD</th>
          <th>PROPIETARIO</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let item of unidadesFiltradas"
          (click)="seleccionarUnidad(item.unidad, item.uid)"
          [ngClass]="{ 'selected': unidadSeleccionada === item.unidad }"
        >
          <td>{{ item.unidad }}</td>
          <td>{{ item.nombre }}</td>
        </tr>
      </tbody>      
    </table>
    
  </ng-container>
  <ng-template #cargandoSpinner>
    <div class="spinner-contenedor">
      <div class="spinner"></div>
      <p>Cargando unidades...</p>
    </div>
  </ng-template>
  </div>

  <!-- DERECHA: Detalle de reportes -->
  <div class="detalle-usuario" *ngIf="unidadSeleccionada">
    <div class="detalle-contenido">
    <ng-container *ngIf="!cargandoReportes; else cargandoSpinner">
    <div *ngIf="reportesSeleccionados.length > 0" class="detalle-usuario">
      <h5 class="titulo-reporte">Reporte acumulado</h5>
      <p><strong>Unidad:</strong> {{ unidadSeleccionada }}</p>
      <p><strong>Reportes encontrados:</strong> {{ reportesSeleccionados.length }}</p>

      <table class="tabla-reportes">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Administrador</th>
            <th>Min. Base</th>
            <th>Min. Atraso</th>
            <th>Multas</th>
          </tr>
        </thead>
        <tbody>
         <tr *ngFor="let reporte of reportesConFechaConvertida">
            <td>{{ reporte.fechaModificacion | date: 'shortDate' }}</td>
            <td>{{ reporte.administracion - reporte.adminPagada | currency:'USD' }}</td>
            <td>{{ reporte.minutosBase - reporte.minBasePagados | currency:'USD' }}</td>
            <td>{{ reporte.minutosAtraso - reporte.minutosPagados | currency:'USD' }}</td>
            <td>{{ reporte.multas - reporte.multasPagadas | currency:'USD' }}</td>
          </tr>
        </tbody>
      </table>

      <div class="totales">
        <p>Administración adeudada: <strong>{{ saldoAdministracion | currency:'USD' }}</strong></p>
        <p>Minutos base adeudados: <strong>{{ saldoMinBase | currency:'USD' }}</strong></p>
        <p>Minutos atraso adeudados: <strong>{{ saldoAtraso | currency:'USD' }}</strong></p>
        <p>Multas adeudadas: <strong>{{ saldoMultas | currency:'USD' }}</strong></p>
        <p class="total">TOTAL ADEUDADO: <strong>{{ total | currency:'USD' }}</strong></p>
      </div>

      <button class="btn-pago" (click)="generarPago()" [disabled]="esSocio">GENERAR PAGO</button>
    </div>
  </ng-container>
  <ng-template #cargandoSpinner>
    <div class="spinner-contenedor">
      <div class="spinner"></div>
      <p>Cargando reportes...</p>
    </div>
  </ng-template>
</div>

</div>
</div>


