<!-- lista-reportes.component.html -->

<div class="contenedor-reportes">

  <!-- Barra superior -->
  <div class="barra-superior">
    <button class="btn-secundario" type="button" (click)="volver()">← Volver</button>

    <div class="grupo-botones">
      <button class="btn-primario" type="button" (click)="agregarDia()" [disabled]="creandoDia">
        {{ creandoDia ? 'Creando día...' : 'Agregar día' }}
      </button>

      <button class="btn-secundario" type="button" (click)="mostrarFiltros = !mostrarFiltros">
        Filtros
      </button>

      <button class="btn-primario" type="button" (click)="irANuevoRegistro()">
        + Nuevo Registro
      </button>
    </div>
  </div>

  <!-- Panel Filtros -->
  <div class="panel-filtros" *ngIf="mostrarFiltros">
    <div class="filtros-rapidos">
      <button type="button" class="btn-chip" (click)="filtrarPor('hoy')">Hoy</button>
      <button type="button" class="btn-chip" (click)="filtrarPor('semana')">Esta semana</button>
      <button type="button" class="btn-chip" (click)="filtrarPor('mes')">Este mes</button>
    </div>

    <div class="filtro-fecha">
      <label for="fechaPersonalizada">Fecha:</label>
      <input
        id="fechaPersonalizada"
        type="date"
        [(ngModel)]="fechaPersonalizada"
        name="fechaPersonalizada"
        class="input-fecha"
      />
      <button type="button" class="btn-secundario" (click)="filtrarPorFechaPersonalizada()">
        Buscar
      </button>
    </div>

    <hr class="separador" />

    <!-- PDFs del día (usa la vista actual: this.reportes) -->
    <div class="acciones-pdf">
      <button type="button" class="btn-secundario" (click)="imprimirPDFMinutosDesdeVista()">
        Imprimir PDF Minutos (vista)
      </button>

      <button type="button" class="btn-secundario" (click)="imprimirPDFAdministracionDesdeVista()">
        Imprimir PDF Administración (vista)
      </button>
    </div>
  </div>

  <!-- Mensajes / Estado -->
  <div class="estado-carga" *ngIf="cargando">
    <p>Cargando reportes...</p>
  </div>

  <div class="mensaje-dia" *ngIf="mostrarMensajeDia && !cargando">
    <p>{{ mensajeEstadoDia }}</p>
  </div>

  <!-- Barra selección múltiple (sin checkboxes) -->
  <div class="acciones-multiples" *ngIf="seleccionCount > 0 && !cargando">
    <span class="seleccion-info">
      Seleccionados: {{ seleccionCount }} / {{ reportes.length }}
    </span>

    <button class="btn-eliminar-multi" type="button" (click)="eliminarSeleccionados()">
      Eliminar seleccionados
    </button>

    <button class="btn-limpiar-multi" type="button" (click)="limpiarSeleccion()">
      Limpiar selección
    </button>
  </div>

  <!-- Tabla -->
  <div class="tabla-wrapper" *ngIf="!cargando">
    <table class="tabla-reportes" *ngIf="reportes.length; else sinDatos">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Nombre</th>
          <th>Unidad</th>
          <th>Min. Atraso</th>
          <th>Min. Pagados</th>
          <th>Administración</th>
          <th>Admin Pagada</th>
          <th>Min. Base</th>
          <th>Min. Base Pagados</th>
          <th>Multas</th>
          <th>Multas Pagadas</th>
          <th class="col-acciones">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let r of reportes; trackBy: trackByReporte"
          (dblclick)="toggleSeleccionFila(r)"
          [class.fila-seleccionada]="isSelected(r)"
          title="Doble clic para seleccionar/deseleccionar"
        >
          <!-- Fecha -->
          <td>
            {{
              (r.fechaModificacion ? (r.fechaModificacion | date:'yyyy-MM-dd') : (fechaPersonalizada || ''))
            }}
          </td>

          <td class="col-nombre">{{ r.nombre }}</td>
          <td>{{ r.unidad }}</td>

          <td>{{ r.minutosAtraso }}</td>
          <td>{{ r.minutosPagados }}</td>

          <td>{{ r.administracion }}</td>
          <td>{{ r.adminPagada }}</td>

          <td>{{ r.minutosBase }}</td>
          <td>{{ r.minBasePagados }}</td>

          <td>{{ r.multas }}</td>
          <td>{{ r.multasPagadas }}</td>

          <td class="col-acciones">
            <div class="acciones">
              <!-- EDITAR -->
              <button
                type="button"
                class="btn-icono editar"
                title="Editar"
              (click)="irAEditar(r); $event.stopPropagation()"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zm2.92 2.83H5v-.92l9.06-9.06.92.92L5.92 20.08zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
              </button>

              <!-- PAGAR -->
              <button
                type="button"
                class="btn-icono pagar"
                title="Pagar"
                (click)="irAPagar(r); $event.stopPropagation()"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4H4V6h16v2zm-8 8H6v-2h6v2z"/>
                </svg>
              </button>

              <!-- ELIMINAR -->
              <button
                type="button"
                class="btn-icono eliminar"
                title="Eliminar"
                (click)="eliminarReporte(r); $event.stopPropagation()"
              >
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M6 7h12v14H6V7zm3-3h6l1 1h4v2H4V5h4l1-1z"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <ng-template #sinDatos>
      <div class="sin-datos">
        <p>No hay registros para mostrar.</p>
      </div>
    </ng-template>
  </div>

  <div class="nota-ayuda" *ngIf="!cargando && reportes.length">
    <small>
      Tip: Doble clic sobre una fila para seleccionarla. Las filas seleccionadas se resaltan para eliminar en bloque.
    </small>
  </div>

</div>
