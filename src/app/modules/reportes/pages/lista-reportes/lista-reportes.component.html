<body>
  <!-- Overlay de carga -->
  <div class="overlay-cargando" *ngIf="cargando">
    <div class="spinner"></div>
    <p>Cargando reportes...</p>
  </div>

  <!-- Contenido principal -->
  <div class="tabla-container" *ngIf="!cargando">
    <h5>N√ìMINA DE RECAUDACI√ìN</h5>
    <button class="boton-volver" (click)="volver()">‚Üê Volver</button>

    <!-- Contenedor de acciones superior -->
    <div class="acciones-globales">
      <!-- Izquierda: Reporte Empresas -->
      <div class="acciones-empresas">
        <button (click)="mostrarOpcionesEmpresa = !mostrarOpcionesEmpresa">
          <span class="material-icons">business</span>
          Generar Reporte Empresas
        </button>
      </div>

      <!-- Derecha: Filtros y nuevo registro -->
      <div class="acciones-secundarias">
        <button class="nuevo-registro" (click)="agregarDia()" [disabled]="creandoDia">
          {{ creandoDia ? 'Creando d√≠a...' : 'Agregar d√≠a' }}
        </button>

        <button class="filtro" (click)="mostrarFiltros = !mostrarFiltros">
          <span class="material-icons">filter_alt</span>
        </button>

        <button class="nuevo-registro" (click)="irANuevoRegistro()" [disabled]="esSocio">
          <span class="material-icons">add</span>
          Nuevo Registro
        </button>
      </div>
    </div>

    <!-- Panel Reporte Empresas -->
    <div *ngIf="mostrarOpcionesEmpresa" class="panel-empresa">
      <div class="botones-empresa">
        <button
          (click)="seleccionarEmpresa('Pintag')"
          [class.activa]="empresaSeleccionada === 'General Pintag'"
        >
          Pintag
        </button>

        <button
          (click)="seleccionarEmpresa('Antisana')"
          [class.activa]="empresaSeleccionada === 'Expreso Antisana'"
        >
          Antisana
        </button>
      </div>

      <div *ngIf="empresaSeleccionada" class="filtros-fecha">
        <label>Fecha de inicio:</label>
        <input type="date" [(ngModel)]="fechaInicio" (change)="validarRangoFechas()" />

        <label>Fecha de fin:</label>
        <input type="date" [(ngModel)]="fechaFin" (change)="validarRangoFechas()" />

        <p class="error" *ngIf="errorFecha">{{ errorFecha }}</p>

        <button
          class="generar-reporte"
          (click)="generarReporteEmpresasPDF()"
          [disabled]="!fechaInicio || !fechaFin || !!errorFecha"
        >
          <span class="material-icons">picture_as_pdf</span>
          Generar PDF
        </button>
      </div>
    </div>


    <!-- Panel de filtros -->
    <div class="panel-filtros" *ngIf="mostrarFiltros">

      <!-- Accesos r√°pidos -->
      <div class="filtros-rapidos">
        <button (click)="filtrarPor('hoy')">Hoy</button>
        <button (click)="filtrarPor('semana')">Esta semana</button>
        <button (click)="filtrarPor('mes')">Este mes</button>
      </div>

      <!-- Fecha exacta -->
      <div class="filtro-personalizado">
        <label for="fecha">Fecha:</label>
        <input type="date" [(ngModel)]="fechaPersonalizada" id="fecha" />
        <button (click)="filtrarPorFechaPersonalizada()">Buscar</button>

        <div class="acciones-imprimir" *ngIf="fechaPersonalizada">
          <button class="boton-imprimir" (click)="imprimirPDFMinutosDesdeVista()">
            <span class="material-icons">schedule</span>
            Imprimir Minutos
          </button>

          <button class="boton-imprimir" (click)="imprimirPDFAdministracionDesdeVista()">
            <span class="material-icons">receipt_long</span>
            Imprimir Administraci√≥n
          </button>
        </div>
      </div>

      <!-- Volver al √∫ltimo d√≠a generado -->
      <button class="limpiar" (click)="cargarUltimoDiaGenerado()">
        Volver al √∫ltimo d√≠a
      </button>

    </div>


    <!-- Mensaje cuando no hay datos -->
   <div class="sin-datos" *ngIf="reportes.length === 0 && !mostrarMensajeDia">
      <p>No hay registros para mostrar.</p>
      <p>
        Usa el filtro por fecha para cargar un d√≠a espec√≠fico o presiona
        <strong>Agregar d√≠a</strong>.
      </p>
    </div>
<!-- Mensaje de estado del d√≠a -->
<div class="mensaje-dia-wrap" *ngIf="mostrarMensajeDia">
  <div class="mensaje-dia">

    <div class="mensaje-texto">
      <p>{{ mensajeEstadoDia }}</p>
    </div>
  </div>
</div>

    <!-- Tabla principal (N√ìMINA diaria compilada) -->
    <table *ngIf="reportes.length > 0">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Nombre</th>
          <th>Unidad</th>
          <th>Min. Atraso</th>
          <th>Min. Pagados</th>
          <th>Administraci√≥n</th>
          <th>Admin Pagada</th>
          <th>Min. Base</th>
          <th>Min. Base Pagados</th>
          <th>Multas</th>
          <th>Multas Pagadas</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let reporte of reportes">
          <td>{{ reporte.fechaModificacion | date: 'dd/MM/yyyy' }}</td>
          <td data-label="Nombre">{{ (reporte.nombre || '') + ' ' + (reporte.apellido || '') }}</td>
          <td data-label="Unidad">{{ reporte.unidad }}</td>
          <td data-label="Min. Atraso">{{ reporte.minutosAtraso }}</td>
          <td data-label="Min. Pagados">{{ reporte.minutosPagados }}</td>
          <td data-label="Administraci√≥n">{{ reporte.administracion }}</td>
          <td data-label="Admin Pagada">{{ reporte.adminPagada }}</td>
          <td data-label="Min. Base">{{ reporte.minutosBase }}</td>
          <td data-label="Min. Base Pagados">{{ reporte.minBasePagados }}</td>
          <td data-label="Multas">{{ reporte.multas }}</td>
          <td data-label="Multas Pagadas">{{ reporte.multasPagadas }}</td>

          <td class="acciones" data-label="Acciones">
            <div class="acciones-contenedor">
              <button class="editar" (click)="irAEditar(reporte.uid, reporte.id)" [disabled]="esSocio">
                <span class="material-icons">edit</span>
              </button>

              <button class="pagar" (click)="irAPagar(reporte.uid, reporte.id)" [disabled]="esSocio">
                <span class="material-icons">payments</span>
              </button>

              <button class="eliminar" (click)="eliminarReporte(reporte)">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Overlay PDF -->
    <div *ngIf="cargandoPDF" class="overlay-cargando">
      <div class="spinner-pdf">
        <p>üåÄ Generando PDF, por favor espera...</p>
      </div>
    </div>

    <!-- Botones inferiores -->
    <div class="botones-inferiores">
      <button (click)="irACuentasPorCobrar()">
        <span class="material-icons">account_balance_wallet</span>
        Cuentas por cobrar
      </button>
      <button (click)="irACierreCaja()">
        <span class="material-icons">check_circle</span>
        Cierre de Caja
      </button>
    </div>
  </div>
</body>
