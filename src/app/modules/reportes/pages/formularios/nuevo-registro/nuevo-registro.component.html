<div class="nuevo-registro-card">
  <h2>Nuevo Registro</h2>

  <form (ngSubmit)="enviar()" #form="ngForm">

    <!-- UNIDAD + NOMBRE -->
    <div class="row">
      <!-- UNIDAD (buscador con sugerencias flotantes) -->
      <div class="form-group">
        <label for="unidadBuscador">Unidad</label>

        <input
          id="unidadBuscador"
          class="input-text"
          name="unidadBuscada"
          [(ngModel)]="unidadBuscada"
          placeholder="Seleccione una unidad"
          autocomplete="off"
          required
          (focus)="mostrarUnidadesDisponibles()"
          (click)="mostrarUnidadesDisponibles()"
          (input)="filtrarPorUnidad()"
          (blur)="cerrarDropdownConDelay()"
        />

        <!-- Dropdown flotante -->
        <div class="dropdown-resultados" *ngIf="dropdownAbierto && unidadesFiltradas.length > 0">
          <button
            type="button"
            class="item-resultado"
            *ngFor="let u of unidadesFiltradas"
            (mousedown)="seleccionarUnidad(u)"
          >
            <strong>Unidad {{ u.codigo }}</strong>
            <span class="sub">â€” {{ u.propietarioNombre }} ({{ u.empresa }})</span>
          </button>
        </div>

        <!-- SelecciÃ³n actual -->
        <div class="seleccion-actual" *ngIf="unidadSeleccionada">
          <small>
            Seleccionado:
            <strong>Unidad {{ unidadSeleccionada.codigo }}</strong>
            â€” {{ unidadSeleccionada.propietarioNombre }} ({{ unidadSeleccionada.empresa }})
          </small>
          <button type="button" class="btn-limpiar" (click)="limpiarSeleccion()">
            Quitar
          </button>
        </div>
      </div>

      <!-- NOMBRE (readonly) -->
      <div class="form-group">
        <label for="nombre">Nombre</label>
        <input
          id="nombre"
          class="input-text"
          name="nombre"
          [(ngModel)]="reporte.nombre"
          placeholder="Se completa automÃ¡ticamente"
          readonly
          required
        />
      </div>
    </div>

    <!-- APELLIDO + UNIDAD SELECCIONADA -->
    <div class="row">
      <div class="form-group">
        <label for="apellido">Apellido</label>
        <input
          id="apellido"
          class="input-text"
          name="apellido"
          [(ngModel)]="reporte.apellido"
          placeholder="Se completa automÃ¡ticamente"
          readonly
        />
      </div>

      <div class="form-group">
        <label for="unidadFinal">Unidad seleccionada</label>
        <input
          id="unidadFinal"
          class="input-text"
          name="unidadFinal"
          [(ngModel)]="reporte.unidad"
          readonly
        />
      </div>
    </div>

    <!-- ADMINISTRACIÃ“N + MIN BASE -->
    <div class="row">
      <div class="form-group">
        <label>AdministraciÃ³n</label>
        <input
          type="number"
          class="input-text"
          name="administracion"
          [(ngModel)]="reporte.administracion"
          required
        />
      </div>

      <div class="form-group">
        <label>Minutos Base</label>
        <input
          type="number"
          class="input-text"
          name="minutosBase"
          [(ngModel)]="reporte.minutosBase"
          required
        />
      </div>
    </div>

    <!-- MIN ATRASO + MULTAS -->
    <div class="row">
      <div class="form-group">
        <label>Minutos Atraso</label>
        <input
          type="number"
          class="input-text"
          name="minutosAtraso"
          [(ngModel)]="reporte.minutosAtraso"
          required
        />
      </div>

      <div class="form-group">
        <label>Multas</label>
        <input
          type="number"
          class="input-text"
          name="multas"
          [(ngModel)]="reporte.multas"
          required
        />
      </div>
    </div>

    <!-- FECHA -->
    <div class="form-group">
      <label for="fecha">Fecha del reporte</label>
      <input
        type="date"
        id="fecha"
        class="form-control"
        name="fecha"
        [(ngModel)]="fechaInput"
        required
      />
    </div>

    <!-- BOTONES -->
    <div class="acciones-formulario">
      <button type="submit" class="guardar" [disabled]="!unidadSeleccionada">
        ðŸ’¾ Guardar
      </button>
      <button type="button" class="cancelar" (click)="cancelar()">
        Cancelar
      </button>
    </div>

  </form>

  <p *ngIf="resultado">âœ… {{ resultado }}</p>
</div>
