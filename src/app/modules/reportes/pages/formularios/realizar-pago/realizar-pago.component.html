<div class="pago-container">
  <div class="pago-header">
    <span class="material-icons icono-pago">payments</span>
    <h2>Gesti√≥n de Pago</h2>
  </div>

  <div class="info-usuario" *ngIf="registros.length > 0">
    <p><strong>Nombre:</strong> {{ registros[0].nombre }}</p>
    <p><strong>Unidad:</strong> {{ registros[0].unidad }}</p>
  </div>

  <!-- Contenedor de los m√≥dulos -->
  <div class="contenedor-modulos">
    <div class="modulo" *ngFor="let campo of campos">
      <h3>{{ campo | titlecase }}</h3>

      <div class="tabla-pagos" *ngFor="let registro of registros">
        <table>
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Pagado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let pago of filtrarPagosPorRegistro(campo, registro.id!)">
              <td>{{ pago.fecha['toDate']() | date:'shortDate' }}</td>
              <td>{{ pago.cantidad }}</td>
            </tr>
            <tr *ngIf="filtrarPagosPorRegistro(campo, registro.id!).length === 0">
              <td colspan="2">Sin pagos registrados</td>
            </tr>
            <tr>
              <td><strong>Total pagado:</strong></td>
              <td><strong>{{ calcularTotalPagado(campo, registro.id!) }}</strong></td>
            </tr>
            <tr>
              <td><strong>Deuda:</strong></td>
              <td><strong>{{ calcularDeuda(registro, campo) }}</strong></td>
            </tr>
            <tr>
              <td><strong>Pago actual:</strong></td>
              <td>
                <input
                  type="number"
                  min="0"
                  [max]="calcularDeuda(registro, campo)"
                  [(ngModel)]="pagosActuales[registro.id!][campo]"
                  (ngModelChange)="validarPago(registro.id!, campo)"
                  placeholder="Ingrese pago"
                />
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="resumen-total">
    <h3>Total a pagar:</h3>
    <p class="total-pagar">${{ calcularTotalGeneral() }}</p>
  </div>

  <div class="acciones-finales">
    <button class="volver" (click)="volver()">‚¨ÖÔ∏è Volver</button>
    <button class="guardar" (click)="guardarPagosGenerales()">üíæ Guardar pagos</button>
  </div>
</div>
